{% extends "base.html" %}

{% block meta %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="accordion" id="accordionSettings">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                    aria-expanded="true" aria-controls="collapseOne">
                    Пользователи
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                data-bs-parent="#accordionSettings">
                <div class="accordion-body">
                    {% for user in users %}
                    {% include 'admin/_user.html' %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Функции импорта
                </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                data-bs-parent="#accordionSettings">
                <div class="accordion-body">
                    {% include 'admin/_functions.html' %}
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Отчёты
                </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                data-bs-parent="#accordionSettings">
                <div class="accordion-body">
                    {% include 'admin/_reports.html' %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block templates%}
{% endblock %}


{% block scripts %}
<script>
    const selectReport = document.getElementById("selectReport");
    const selectFunction = document.getElementById("selectFunction");

    selectReport.addEventListener("change", function (event) {
        const form = document.getElementById("reportForm");
        const currentOption = event.target.options[event.target.selectedIndex];
        const reportId = parseInt(currentOption.value) || "";
        const reportDescriptionInput = document.getElementById("report_description");
        const reportFuncInput = document.getElementById("report_func");
        const reportNameInput = document.getElementById("report_name");
        if (reportId) {
            form.action = "{{url_for('admin.modify_report', report_id=-1)}}".replace("-1", reportId);
            reportDescriptionInput.value = currentOption.dataset.description;
            reportFuncInput.value = currentOption.dataset.func;
            reportNameInput.value = currentOption.text;
        } else {
            form.action = "{{url_for('admin.add_report')}}";
            reportDescriptionInput.value = "";
            reportNameInput.value = "";
        }
    });
    selectFunction.addEventListener("change", function (event) {
        const form = document.getElementById("functionForm");
        const currentOption = event.target.options[event.target.selectedIndex];
        const functionId = parseInt(currentOption.value) || "";
        const funcDescriptionInput = document.getElementById("func_description");
        const funcClassInput = document.getElementById("func_class");
        const funcNameInput = document.getElementById("func_name");
        if (functionId) {
            form.action = "{{url_for('admin.modify_function', func_id=-1)}}".replace("-1", functionId);
            funcDescriptionInput.value = currentOption.dataset.description;
            funcClassInput.value = currentOption.dataset.class;
            funcNameInput.value = currentOption.text;
        } else {
            form.action = "{{url_for('admin.add_function')}}";
            funcDescriptionInput.value = "";
            funcClassInput.value = "";
            funcNameInput.value = "";
        }
    });
</script>
{% endblock %}
